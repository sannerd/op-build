From 881f9e4a1499b1d017045b6e41dc7b1b0b565dcf Mon Sep 17 00:00:00 2001
From: Dean Sanner <dsanner@us.ibm.com>
Date: Thu, 23 Feb 2017 06:13:49 -0600
Subject: [PATCH v1 1002/1002] Defer setup of MC multicast groups in async mode

Change-Id: I42a8ed1c11ca995a3368c60af63afc8c9e46ed41
---
 src/import/chips/p9/procedures/hwp/perv/p9_mem_startclocks.C | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/src/import/chips/p9/procedures/hwp/perv/p9_mem_startclocks.C b/src/import/chips/p9/procedures/hwp/perv/p9_mem_startclocks.C
index 35f0554..c529d8b 100644
--- a/src/import/chips/p9/procedures/hwp/perv/p9_mem_startclocks.C
+++ b/src/import/chips/p9/procedures/hwp/perv/p9_mem_startclocks.C
@@ -44,6 +44,8 @@
 #include "p9_perv_scom_addresses_fld.H"
 #include "p9_quad_scom_addresses_fld.H"
 #include "p9_sbe_common.H"
+#include "p9_sbe_chiplet_reset.H"  //For MCGR_CNFG_SETTING_GROUP
+
 
 enum P9_MEM_STARTCLOCKS_Private_Constants
 {
@@ -134,6 +136,16 @@ fapi2::ReturnCode p9_mem_startclocks(const
             .insertFromRight<PERV_1_CPLT_CONF0_TC_UNIT_CHIP_ID_DC, PERV_1_CPLT_CONF0_TC_UNIT_CHIP_ID_DC_LEN>(l_fbc_chip_id);
             FAPI_TRY(fapi2::putScom(l_trgt_chplt, PERV_CPLT_CONF0, l_cplt_conf0),
                      "Error from putScom (PERV_CPLT_CONF0)");
+
+            FAPI_INF("Reset Add to Multicast Group");
+            //Setting MULTICAST_GROUP_1 register value
+            FAPI_TRY(fapi2::putScom(l_trgt_chplt, PERV_MULTICAST_GROUP_1,
+                                    p9SbeChipletReset::MCGR_CNFG_SETTING_GROUP0));
+
+            //Setting MULTICAST_GROUP_2 register value
+            FAPI_TRY(fapi2::putScom(l_trgt_chplt, PERV_MULTICAST_GROUP_2,
+                                    p9SbeChipletReset::MCGR_CNFG_SETTING_GROUP2));
+
         }
     }
 
-- 
1.8.2.2

